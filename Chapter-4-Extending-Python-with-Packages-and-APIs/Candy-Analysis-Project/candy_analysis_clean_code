#!/usr/bin/env python
# coding: utf-8

# # Programming Assignment: ğŸ­ Candy Analysis ğŸ“Š ç³–æœåˆ†æç¼–ç¨‹ä½œä¸š

import test_your_code

# <a name='1'></a>
# ## Exercise 1: Unwrapping the Data ğŸ ç»ƒä¹ 1ï¼šæ‰“å¼€æ•°æ®

# Import helper functions from external file ä»å¤–éƒ¨æ–‡ä»¶å¯¼å…¥è¾…åŠ©å‡½æ•°
from ex1_helper_functions import *

# Test import statement æµ‹è¯•å¯¼å…¥è¯­å¥
test_your_code.check_ex1_import_statement()

# Read candy data from CSV file ä»CSVæ–‡ä»¶è¯»å–ç³–æœæ•°æ®
candy_data = read_candy_data('candy_data.csv')

# Display candy data in table format ä»¥è¡¨æ ¼å½¢å¼æ˜¾ç¤ºç³–æœæ•°æ®
display_table(candy_data)

# Test Exercise 1
test_your_code.exercise_1(candy_data)

# <a name='2'></a>
# ## Exercise 2: Popularity Contest! ğŸ† ç»ƒä¹ 2ï¼šäººæ°”ç«èµ›ï¼

# Import functions for processing popularity scores å¯¼å…¥å¤„ç†äººæ°”åˆ†æ•°çš„å‡½æ•°
from ex2_helper_functions import get_popularity_scores, print_scores

# Test import statement æµ‹è¯•å¯¼å…¥è¯­å¥
test_your_code.check_ex2_import_statement()

# Extract popularity scores from candy data ä»ç³–æœæ•°æ®ä¸­æå–äººæ°”åˆ†æ•°
popularity_scores = get_popularity_scores(candy_data)

# Display popularity scores æ˜¾ç¤ºäººæ°”åˆ†æ•°
print_scores(popularity_scores)

# Test Exercise 2
test_your_code.exercise_2(popularity_scores)

# <a name='3'></a>
# ## Exercise 3: Finding the Average Sweet Spot ğŸ¯ ç»ƒä¹ 3ï¼šæ‰¾åˆ°å¹³å‡ç”œèœœç‚¹

# Import statistics module for calculations å¯¼å…¥ç»Ÿè®¡æ¨¡å—è¿›è¡Œè®¡ç®—
import statistics as stats

# Test import statement æµ‹è¯•å¯¼å…¥è¯­å¥
test_your_code.check_ex3_import_statement()

# Calculate average popularity score è®¡ç®—å¹³å‡äººæ°”åˆ†æ•°
avg_popularity = stats.mean(popularity_scores)

# Display average popularity with 2 decimal places æ˜¾ç¤ºä¿ç•™2ä½å°æ•°çš„å¹³å‡äººæ°”åˆ†æ•°
print(f"Average Popularity Score: {avg_popularity:.2f}")

# Test Exercise 3
test_your_code.exercise_3(avg_popularity)

# <a name='4'></a>
# ## Exercise 4: The Top Candy Leaderboard ğŸ¥‡ ç»ƒä¹ 4ï¼šé¡¶çº§ç³–æœæ’è¡Œæ¦œ

# Import module for top candy analysis å¯¼å…¥é¡¶çº§ç³–æœåˆ†ææ¨¡å—
import ex4_helper_functions

# Test import statement æµ‹è¯•å¯¼å…¥è¯­å¥
test_your_code.check_ex4_import_statement()

# Get candies with above-average popularity è·å–äººæ°”é«˜äºå¹³å‡æ°´å¹³çš„ç³–æœ
top_candies = ex4_helper_functions.get_top_candies(candy_data, avg_popularity)

# Display top candies in formatted table ä»¥æ ¼å¼åŒ–è¡¨æ ¼æ˜¾ç¤ºé¡¶çº§ç³–æœ
ex4_helper_functions.display_pretty_table(top_candies)

# Test Exercise 4
test_your_code.exercise_4(top_candies)

# <a name='5'></a>
# ## Exercise 5: Crafting the Perfect Description âœï¸ ç»ƒä¹ 5ï¼šåˆ¶ä½œå®Œç¾æè¿°

# Import client for LLM functionality å¯¼å…¥LLMåŠŸèƒ½å®¢æˆ·ç«¯
from ex5_helper_functions import client

# Define function to get LLM responses å®šä¹‰è·å–LLMå“åº”çš„å‡½æ•°
def get_llm_response(prompt):
    completion = client.chat.completions.create( 
        model='gpt-4o-mini', 
        messages=[ 
            {
                "role": "system",
                "content": "You are an rude AI assistant.", # è®¾ç½®ä¸ºç²—é²çš„AIåŠ©æ‰‹
            },
            {"role": "user", "content": prompt},
        ],
        temperature=0.7, # è®¾ç½®æ¸©åº¦å‚æ•°ä¸º0.7
    )
    response = completion.choices[0].message.content 
    return response

# Test custom LLM function æµ‹è¯•è‡ªå®šä¹‰LLMå‡½æ•°
test_your_code.check_change_in_ex5()

# Generate descriptions for top candies ä¸ºé¡¶çº§ç³–æœç”Ÿæˆæè¿°
for candy in top_candies:
    prompt = f"""
    For the given candy name, {candy['Candy Name']}, write a short, catchy two-sentence description.
    """
    response = get_llm_response(prompt)
    print(f"NAME: {candy['Candy Name']}")
    print(f"DESCRIPTION: {response}")
    print()